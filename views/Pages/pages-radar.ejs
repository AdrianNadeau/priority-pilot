<%- contentFor('HeaderCss') %>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="frappe-gantt.min.js"></script>
<link rel="stylesheet" href="frappe-gantt.css">

<%- contentFor('breadcrumb') %>
<ul class="list-inline menu-left mb-0">
    <li class="list-inline-item">
        <button type="button" class="button-menu-mobile open-left waves-effect">
            <i class="ion-navicon"></i>
        </button>
    </li>
    <li class="hide-phone list-inline-item app-search">
        
        <div><h3 class="page-title">In-Flight Health</h3>
        <span style="padding-left:40px;"><%= new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %></span></div>
        
    </li>
</ul>

<%- contentFor('body') %>
<div class="page-content-wrapper">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
              <div class="card-body" style="border:0px !important;">
                        <div class="table-responsive">
                            <table class="table mb-0">
                                <thead>
                                    <tr>
                                        <th>Project</th>
                                        <th>Start</th>
                                        <th>End</th>
                                        <th>NMS</th>
                                        <th>Prime</th>
                                        <th>Sponsor</th>
                                        <th>Issue(s)</th>
                                        <th>Actions</th>
                                       
                                       
                                    </tr>
                                </thead>
                                <tbody>
                                    <% let currentPhase = ''; %>
                                    <% projects.forEach(project => { %>
                                        <% if (project.phase_name === 'Delivery' || project.phase_name === 'Discovery') { %>
                                        <% if (project.phase_name !== currentPhase) { %>
                                            <% currentPhase = project.phase_name; %>
                                            <tr>
                                            <td colspan="9" style="background-color:#ececec;font-weight: bold; text-align: center;"><%= currentPhase %></td>
                                            </tr>
                                        <% } %>
                                       
                                        <% let backgroundColor = '#CCC'; %>
                                        <% if (project.health && project.health.toLowerCase().trim() === 'yellow') { %>
                                          <% backgroundColor = '#FFFF00'; %> <!-- Yellow color -->
                                        <% } else if (project.health && project.health.toLowerCase().trim() === 'green') { %>
                                          <% backgroundColor = '#00FF00'; %> <!-- Green color -->
                                        <% } else if (project.health && project.health.toLowerCase().trim() === 'red') { %>
                                          <% backgroundColor = '#FF0000'; %> <!-- Red color -->
                                        <% } %>
                                        <tr>

                                            <td style="background-color:<%= backgroundColor %>;color:black;font-weight: bold;"><%= project.project_name %></td>
                                            <td><% if (project.start_date) { %><%= new Date(project.start_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %><% } %></td>
                                            <td><% if (project.end_date) { %><%= new Date(project.end_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %><% } %></td>
                                            <td><% if (project.next_milestone_date) { %><%= new Date(project.next_milestone_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %><% } %></td>
                                            <td><%= project.prime_first_name %> <%= project.prime_last_name %></td>
                                            <td><%= project.sponsor_first_name %> <%= project.sponsor_last_name %></td>
                                            <td><%= project.issue %></td>
                                            <td><%= project.actions %></td>
                                            
                                        </tr>
                                        <% } %>
                                    <% }); %>
                                </tbody>
                            </table>
                        </div>
                      </div>
                    </div>
                </div>
            </div> -->
      <!-- <div class="col-lg-3">
                
                <div class="card-body">
                    <canvas id="myBubbleChart" style="width:300px;"></canvas>
                    

                </div>
            </div>-->
    </div>
    <!-- <div class="row">
      <div class="col-lg-2 text-center">
        <div class="card-body p-2">
          <strong class="h3">Funnel</strong>
          <br />
          <button
            type="button"
            class="btn btn-light"
            style="
              background-color: #e2e6ea;
              border-color: #e2e6ea;
              margin-bottom: 5px;
              width: 120px;
              height: 50px;
            "
          >
            <%= pitchCount %>
          </button>
          <br />
          <button
            type="button"
            class="btn btn-light"
            style="
              background-color: #e2e6ea;
              border-color: #e2e6ea;
              margin-bottom: 5px;
              width: 120px;
              height: 50px;
            "
          >
            $<%= pitchCost %>
          </button>
        </div>
      </div>
      <div class="col-lg-2 text-center">
        <div class="card-body p-2">
          <strong class="h3">Priority</strong>
          <br />
          <button
            type="button"
            class="btn btn-light"
            style="
              background-color: #e2e6ea;
              border-color: #e2e6ea;
              margin-bottom: 5px;
              width: 120px;
              height: 50px;
            "
          >
            <%= priorityCount %>
          </button>
          <br />
          <button
            type="button"
            class="btn btn-light"
            style="
              background-color: #e2e6ea;
              border-color: #e2e6ea;
              margin-bottom: 5px;
              width: 120px;
              height: 50px;
            "
          >
            $<%= priorityCost %>
          </button>
        </div>
      </div>
      <div class="col-lg-2 text-center">
        <div class="card-body p-2">
          <strong class="h3">Discovery</strong>
          <br />
          <button
            type="button"
            class="btn btn-light"
            style="
              background-color: #e2e6ea;
              border-color: #e2e6ea;
              margin-bottom: 5px;
              width: 120px;
              height: 50px;
            "
          >
            <%= discoveryCount %>
          </button>
          <br />
          <button
            type="button"
            class="btn btn-light"
            style="
              background-color: #e2e6ea;
              border-color: #e2e6ea;
              margin-bottom: 5px;
              width: 120px;
              height: 50px;
            "
          >
            $<%= discoveryCost %>
          </button>
        </div>
      </div>
      <div class="col-lg-2 text-center">
        <div class="card-body p-2">
          <strong class="h3">Delivery</strong>
          <br />
          <button
            type="button"
            class="btn btn-light"
            style="
              background-color: #e2e6ea;
              border-color: #e2e6ea;
              margin-bottom: 5px;
              width: 120px;
              height: 50px;
            "
          >
            <%= deliveryCount %>
          </button>
          <br />
          <button
            type="button"
            class="btn btn-light"
            style="
              background-color: #e2e6ea;
              border-color: #e2e6ea;
              margin-bottom: 5px;
              width: 120px;
              height: 50px;
            "
          >
            $<%= deliveryCost %>
          </button>
        </div>
      </div>
      <div class="col-lg-2 text-center">
        <div class="card-body p-2">
          <strong class="h3">Complete</strong>
          <br />
          <button
            type="button"
            class="btn btn-light"
            style="
              background-color: #e2e6ea;
              border-color: #e2e6ea;
              margin-bottom: 5px;
              width: 120px;
              height: 50px;
            "
          >
            <%= operationsCount %>
          </button>
          <br />
          <button
            type="button"
            class="btn btn-light"
            style="
              background-color: #e2e6ea;
              border-color: #e2e6ea;
              margin-bottom: 5px;
              width: 120px;
              height: 50px;
            "
          >
            $<%= operationsCost %>
          </button>
        </div>
      </div>
    </div> -->
  </div>

  <%- contentFor('FooterJs') %> <%- contentFor('BottomJs') %>
  <script>
    const ctx = document.getElementById("humpChart").getContext("2d");

    // Define the static mountain-like hump
    const humpData = {
      labels: ["Project A", "Project B", "Project C", "Project D", "Project E"],
      datasets: [
        {
          label: "Radar",
          data: [0.3, 0.6, 0.8, 0.6, 0.3],
          backgroundColor: "rgba(173, 216, 230, 0.2)",
          borderColor: "rgba(173, 216, 230, 1)",
          borderWidth: 2,
          pointRadius: 0,
          tension: 0.4,
        },
      ],
    };

    // Dynamic data points for projects
    const projectData = [0.1, 0.5, 0.7, 0.5, 0.2, 0.3, 0.1]; // Example dynamic data

    // Calculate y-values for dynamic data based on the hump curve
    const dynamicData = humpData.datasets[0].data.map((value, index) => {
      const x = index / (humpData.datasets[0].data.length - 1); // Normalize x-axis values
      const y = value + (projectData[index] - 0.5) * 0.3; // Adjust y-values based on project data
      return y;
    });

    // Update the static hump data with dynamic data
    humpData.datasets = [
      {
        label: "Dynamic Data",
        data: dynamicData,
        backgroundColor: "gray",
        borderColor: "gray",
        borderWidth: 2,
        pointRadius: 15,
        pointBackgroundColor: "yellow",
        pointBorderColor: "#fff",
        pointHoverRadius: 8,
        pointHoverBackgroundColor: "#fff",
        pointHoverBorderColor: "rgba(244, 144, 255, 1)",
        tension: 0.4,
      },
    ];

    const humpChart = new Chart(ctx, {
      type: "line",
      data: humpData,
      options: {
        scales: {
          x: {
            title: {
              display: true,
              text: "Projects",
            },
          },
          y: {
            min: 0,
            max: 1,
            ticks: {
              callback: function (value) {
                return value === 0.5 ? "Progress" : "";
              },
              stepSize: 0.1,
            },
            title: {
              display: true,
              text: "Status",
            },
          },
        },
        plugins: {
          title: {
            display: true,
            text: "Dynamic Data on Static Hump Line",
          },
          tooltip: {
            callbacks: {
              label: function (context) {
                return context.dataset.label + ": " + context.raw.toFixed(2);
              },
            },
          },
        },
      },
    });
  </script>
  <script>
    // Generate random data
    function generateRandomData(numPoints) {
      const data = [];
      for (let i = 0; i < numPoints; i++) {
        data.push({
          x: Math.random() * 10, // Random business change value (0 to 10)
          y: Math.random() * 10, // Random technical complexity value (0 to 10)
          r: Math.random() * 20, // Random bubble size (0 to 20)
        });
      }
      return data;
    }

    // Sample data
    const initialData = generateRandomData(10);

    const data = {
      datasets: [
        {
          label: "Projects",
          data: initialData,
          backgroundColor: "#519ce0 ", // Bubble color
        },
      ],
    };

    // Configuration options
    const options = {
      responsive: true,
      scales: {
        x: {
          type: "linear",
          position: "bottom",
          title: {
            display: true,
            text: "Technical Complexity ",
          },
        },
        y: {
          type: "linear",
          position: "left",
          title: {
            display: true,
            text: "Business Change",
          },
        },
      },
    };

    // Create the bubble chart
    const ctx_bubble = document
      .getElementById("myBubbleChart")
      .getContext("2d");
    const myBubbleChart = new Chart(ctx_bubble, {
      type: "bubble",
      data: data,
      options: options,
    });

    // Function to add more random data points
    function addRandomData(numPointsToAdd) {
      const newData = generateRandomData(numPointsToAdd);
      myBubbleChart.data.datasets[0].data =
        myBubbleChart.data.datasets[0].data.concat(newData);
      myBubbleChart.update();
    }

    // Add more random data points every 2 seconds
    //setInterval(function() {
    //addRandomData(5); // Add 5 new random data points
    //}, 2000);
  </script>
</div>