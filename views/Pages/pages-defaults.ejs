
<%- contentFor('HeaderCss') %>
<!-- Bootstrap CSS -->
<style>
.mdi-pencil:hover, .mdi-delete:hover {
  color: #007bff; /* Change to your desired hover color */
  cursor: pointer;
}
</style>

<%- contentFor('breadcrumb') %>
<ul class="list-inline menu-left mb-0">
    <li class="list-inline-item">
        <button type="button" class="button-menu-mobile open-left waves-effect">
            <i class="ion-navicon"></i>
        </button>
    </li>
    
    <li class="hide-phone list-inline-item app-search">
        <h3 class="page-title"> Defaults  </h3>
    
    </li>
</ul>
<%- contentFor('body') %>
<div class="page-content-wrapper">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <form action="/companies/set/defaults" class="needs-validation" id="editDefaultsForm" novalidate method="POST">
                    <input type="hidden" id="company_id" name="company_id" value="<%= company.id %>">
                    <div class="row">
                        <div class="col-md-4">
                            <!-- First column of form fields -->
                            <div class="form-group needs-validation" novalidate>
                                <label for="portfolio_budget">Portfolio Budget ($)</label>
                                <input type="text" class="form-control" id="portfolio_budget" oninput="formatNumberWithCommas(this);" name="portfolio_budget" value="<%= company.portfolio_budget %>">
                                <div class="invalid-feedback">
                                    Please enter Portfolio Budget.
                                </div>
                            </div>

                            <div class="form-group needs-validation" novalidate>
                                <label for="portfolio_effort">Portfolio Effort (Person Hours)</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="portfolio_effort" oninput="formatNumberWithCommas(this);" name="portfolio_effort" value="<%= company.effort %>">
                                    
                                </div>
                                <div class="invalid-feedback">
                                    Please enter Portfolio Effort.
                                </div>
                            </div>

                            <div class="form-group needs-validation" novalidate>
                                <label for="tags">Company Tags</label>
                                <% if (tags.length > 0) { %>
                                    <ul>
                                        <% tags.forEach(function(tag) { %>
                                            <li>
                                                <%= tag.tag_name %>
                                                <% if (tag.company_id_fk === 0) { %>
                                                    (system tag)
                                                <% } else { %>
                                                  <i class="mdi mdi-pencil" data-toggle="modal" data-target="#editTagModal" onclick="editTag('<%= tag.id %>', '<%= tag.tag_name %>', '<%= tag.company_id_fk %>')" title="Edit Tag"></i>
                                                  <i class="mdi mdi-delete" data-toggle="modal" data-target="#editTagModal" onclick="deleteTag('<%= tag.id %>')" title="Delete Tag"></i>
                                                <% } %>
                                            </li>
                                        <% }); %>
                                    </ul>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Edit Tag Modal -->
<div class="modal fade" id="editTagModal" tabindex="-1" role="dialog" aria-labelledby="editTagModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editTagModalLabel">Edit Tag</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="editTagForm">
          <div class="form-group">
            <label for="tag_name">Tag Name</label>
            <input type="text" class="form-control" id="tag_name" name="tag_name">
          </div>
          <input type="hidden" id="tag_id" name="tag_id">
          <input type="hidden" id="company_id_fk" name="company_id_fk">
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="saveTag()">Save changes</button>
      </div>
    </div>
  </div>
</div>

<%- contentFor('FooterJs') %>
<%- contentFor('BottomJs') %>
<script>
  (function () {
    'use strict'
  
    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    var forms = document.querySelectorAll('.needs-validation')
  
    // Loop over them and prevent submission
    Array.prototype.slice.call(forms)
      .forEach(function (form) {
        form.addEventListener('submit', function (event) {
          if (!form.checkValidity()) {
            event.preventDefault()
            event.stopPropagation()
          }
  
          form.classList.add('was-validated')
        }, false)
      })
  })()

  function editTag(tagId, tagName, companyId) {
    document.getElementById('tag_id').value = tagId;
    document.getElementById('tag_name').value = tagName;
    document.getElementById('company_id_fk').value = companyId;
  }

  function saveTag(tag_id, tag_name, company_id_fk) {
    // Implement the logic to save the tag details
    console.log('Save tag with ID:', document.getElementById('tag_id').value);
    console.log('Tag name:', document.getElementById('tag_name').value);
    console.log('Company ID:', document.getElementById('company_id_fk').value);
    // Post updated tag name
    $.ajax({
      url: '/tags/' + document.getElementById('tag_id').value+"/"+document.getElementById('tag_name').value,
      method: 'PUT',
      data: $('#editTagForm').serialize(),
      success: function(response) {
        $('#editTagModal').modal('hide');
        // Refresh page
        window.location.replace('/companies/get/defaults');
        
      }
    });
  }
</script>