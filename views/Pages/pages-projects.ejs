<%- contentFor('HeaderCss') %>
<style>
  .form-group-inline {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
  }
  .form-group-inline label {
    margin-right: 10px;
  }
  .form-group-inline select {
    margin-right: 10px;
  }
</style>

<%- contentFor('breadcrumb') %>
<ul class="list-inline menu-left mb-0">
    <li class="list-inline-item">
        <button type="button" class="button-menu-mobile open-left waves-effect">
            <i class="ion-navicon"></i>
        </button>
    </li>
    
    <li class="hide-phone list-inline-item app-search">
        <h3 class="page-title">Projects</h3>
        <button type="button" class="btn btn-primary waves-effect waves-light" data-toggle="modal" data-target="#addProject" id="btnAddProject">Add Project</button>
        
    </li>
</ul>

<%- contentFor('body') %>
<div class="page-content-wrapper">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
              <div class="card-body" style="border:0px !important;">
                        <div class="table-responsive">
                          
                            <table class="table mb-0">
                                <thead>
                                    <tr>
                                        <!-- <th>ID</th> -->
                                        <th>Name</th>
                                        <th>Prime</th>
                                        <th>Sponsor</th>
                                        <th>Start</th>
                                        <th>End</th>
                                        
                                        <th>Phase</th>
                                        <th>Cost</th>
                                    </tr>
                                </thead>
                               
                                <% projects.forEach(function(project) { %>
                                  <tbody>
                                    <tr style="cursor: pointer;">
                                      <td style="display: none;"><%= project.id %></td>
                                          
                                          <td><%= project.project_name %></td>
                              
                                          <% if (project.prime_last_name) { %>
                                              <td><%= project.prime_last_name %>, <%= project.prime_first_name %></td>
                                          <% } else { %>
                                              <td>N/A</td>
                                          <% } %>
                              
                                          <% if (project.sponsor_last_name) { %>
                                              <td><%= project.sponsor_last_name %>, <%= project.sponsor_first_name %></td>
                                          <% } else { %>
                                              <td>N/A</td>
                                          <% } %>
                              
                                          <td>
                                              <% if (project.start_date) { %>
                                                  <%= new Date(project.start_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
                                              <% } %>
                                          </td>
                                          <td>
                                              <% if (project.end_date) { %>
                                                  <%= new Date(project.end_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
                                              <% } %>
                                          </td>
                              
                                          <td><%= project.phase_name %></td>
                                          <td><%= project.project_cost %></td>
                                      </tr>
                                  </tbody>
                              <% }); %>
                              
                              
                             
                            </table>
                        </div>
                      </div>
                    </div>
                </otdiv>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 m-t-30">
                <!-- project modal content -->
                <div id="addProject" class="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                      <div class="modal-content" style="width: 900px;">
                          <div class="modal-header">
                              <h5 class="modal-title mt-0">Add Project</h5>
                              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                          </div>
                          <div class="modal-body">
                            <div class="container">
                              <div class="container">
                                <form action="/projects" class="needs-validation" novalidate method="POST">
                                  <div class="row">
                                    <div class="col-md-6">
                                      <!-- Left Column -->
                                      <div class="form-group">
                                        <label for="project_name">Project Name:</label>
                                        <input type="text" class="form-control" id="project_name" name="project_name" required>
                                        <div class="invalid-feedback">Please enter project name.</div>
                                      </div>
                                      <div class="form-group">
                                        <label for="headline">Headline:</label>
                                        <input type="text" class="form-control" id="headline" name="headline">
                                      </div>
                                      <div class="form-group">
                                        <label for="why">Why:</label>
                                        <textarea class="form-control" id="why" name="why"></textarea>
                                      </div>
                                      <div class="form-group">
                                        <label for="what">What:</label>
                                        <textarea class="form-control" id="what" name="what"></textarea>
                                      </div>
                                      <div class="form-group">
                                        <label for="start_date_year">Start Date:</label>
                                        <div class="form-row">
                                          <div class="col">
                                            <select id="start_date_year" name="start_date_year" class="form-control form-control-wide">
                                              <option value="0" selected>Select...</option>
                                              <% 
                                                const currentYear = new Date().getFullYear();
                                                const years = [];
                                                for (let i = currentYear - 10; i <= currentYear + 5; i++) {
                                                  years.push(i);
                                                }
                                              %>
                                              <% years.forEach(year => { %>
                                                <option value="<%= year %>"><%= year %></option>
                                              <% }); %>
                                            </select>
                                          </div>
                                          <div class="col">
                                            <select id="start_date_month" name="start_date_month" class="form-control form-control-wide">
                                              <option value="0" selected>Select...</option>
                                              <% const monthsOfYear = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]; %>
                                              <% monthsOfYear.forEach(month => { %>
                                                <option value="<%= month %>"><%= month %></option>
                                              <% }); %>
                                            </select>
                                          </div>
                                          <div class="col">
                                            <select id="start_date_day" name="start_date_day" class="form-control form-control-wide">
                                              <option value="0" selected>Select...</option>
                                              <!-- Days will be populated by JavaScript -->
                                            </select>
                                          </div>
                                        </div>
                                      </div>
                                      <div class="form-group">
                                        <label for="end_date_year">End Date:</label>
                                        <div class="form-row">
                                          <div class="col">
                                            <select id="end_date_year" name="end_date_year" class="form-control form-control-wide">
                                              <option value="0" selected>Select...</option>
                                              <% years.forEach(year => { %>
                                                <option value="<%= year %>"><%= year %></option>
                                              <% }); %>
                                            </select>
                                          </div>
                                          <div class="col">
                                            <select id="end_date_month" name="end_date_month" class="form-control form-control-wide">
                                              <option value="0" selected>Select...</option>
                                              <% monthsOfYear.forEach(month => { %>
                                                <option value="<%= month %>"><%= month %></option>
                                              <% }); %>
                                            </select>
                                          </div>
                                          <div class="col">
                                            <select id="end_date_day" name="end_date_day" class="form-control form-control-wide">
                                              <option value="0" selected>Select...</option>
                                              <!-- Days will be populated by JavaScript -->
                                            </select>
                                          </div>
                                        </div>
                                      </div>
                                      <div class="form-group">
                                        <label for="next_milestone_year">Next Milestone Date:</label>
                                        <div class="form-row">
                                          <div class="col">
                                            <select id="next_milestone_year" name="next_milestone_year" class="form-control form-control-wide">
                                              <option value="0" selected>Select...</option>
                                              <% years.forEach(year => { %>
                                                <option value="<%= year %>"><%= year %></option>
                                              <% }); %>
                                            </select>
                                          </div>
                                          <div class="col">
                                            <select id="next_milestone_month" name="next_milestone_month" class="form-control form-control-wide">
                                              <option value="0" selected>Select...</option>
                                              <% monthsOfYear.forEach(month => { %>
                                                <option value="<%= month %>"><%= month %></option>
                                              <% }); %>
                                            </select>
                                          </div>
                                          <div class="col">
                                            <select id="next_milestone_day" name="next_milestone_day" class="form-control form-control-wide">
                                              <option value="0" selected>Select...</option>
                                              <!-- Days will be populated by JavaScript -->
                                            </select>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                    <div class="col-md-6">
                                      <!-- Right Column -->
                                      <div class="form-row">
                                        <div class="col">
                                          <div class="form-group">
                                            <label for="phase">Phase:</label>
                                            <select name="phase_id_fk" id="phase_id_fk" class="form-control">
                                              <% phases.forEach(function(phase){ %>
                                                <option value="<%= phase.id %>"><%= phase.phase_name %></option>
                                              <% }) %>
                                            </select>
                                          </div>
                                        </div>
                                        <div class="col">
                                          <div class="form-group">
                                            <label for="priority">Priority:</label>
                                            <select name="priority_id_fk" id="priority_id_fk" class="form-control">
                                              <% priorities.forEach(function(priority){ %>
                                                <option value="<%= priority.id %>"><%= priority.priority_name %></option>
                                              <% }) %>
                                            </select>
                                          </div>
                                        </div>
                                      </div>
                                      <div class="form-row">
                                        <div class="col">
                                          <div class="form-group">
                                            <label for="sponsor">Sponsor:</label>
                                            <select name="sponsor_id_fk" id="sponsor_id_fk" class="form-control">
                                              <% sponsors.forEach(function(sponsor){ %>
                                                <option value="<%= sponsor.id %>"><%= sponsor.last_name %>, <%= sponsor.first_name %></option>
                                              <% }) %>
                                            </select>
                                          </div>
                                        </div>
                                        <div class="col">
                                          <div class="form-group">
                                            <label for="prime">Prime:</label>
                                            <select name="prime_id_fk" id="prime_id_fk" class="form-control">
                                              <% primes.forEach(function(prime){ %>
                                                <option value="<%= prime.id %>"><%= prime.last_name %>, <%= prime.first_name %></option>
                                              <% }) %>
                                            </select>
                                          </div>
                                        </div>
                                      </div>
                                      <div class="form-row">
                                        <div class="col">
                                          <div class="form-group">
                                            <label for="effort">Effort (PH)</label>
                                            <input type="text" class="form-control" id="effort" name="effort" value="0">
                                          </div>
                                        </div>
                                        <div class="col">
                                          <div class="form-group">
                                            <label for="project_cost">Cost ($)</label>
                                            <input type="text" class="form-control" id="project_cost" name="project_cost" value="0">
                                          </div>
                                        </div>
                                        <div class="col">
                                          <div class="form-group">
                                            <label for="benefit">Benefit (ROI or $)</label>
                                            <input type="text" class="form-control" id="benefit" name="benefit" value="0">
                                          </div>
                                        </div>
                                      </div>
                                        <div class="form-row">
                                          <div class="col">
                                            <div class="form-group">
                                              <label for="tag_1">Tag 1:</label>
                                              <select name="tag_1" id="tag_1" class="form-control">
                                                <% if (tags && tags.length > 0) { %>
                                                  <% tags.forEach(function(tag){ %>
                                                    <option value="<%= tag.id %>"><%= tag.tag_name %></option>
                                                  <% }) %>
                                                <% } else { %>
                                                  <option value="">No tags available</option>
                                                <% } %>
                                              </select>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="form-row">
                                          <div class="col">
                                            <div class="form-group">
                                              <label for="tag_2">Tag 2:</label>
                                              <select name="tag_2" id="tag_2" class="form-control">
                                                <% if (tags && tags.length > 0) { %>
                                                  <% tags.forEach(function(tag){ %>
                                                    <option value="<%= tag.id %>"><%= tag.tag_name %></option>
                                                  <% }) %>
                                                <% } else { %>
                                                  <option value="">No tags available</option>
                                                <% } %>
                                              </select>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="form-row">
                                          <div class="col">
                                            <div class="form-group">
                                              <label for="tag_3">Tag 3:</label>
                                              <select name="tag_3" id="tag_3" class="form-control">
                                                <% if (tags && tags.length > 0) { %>
                                                  <% tags.forEach(function(tag){ %>
                                                    <option value="<%= tag.id %>"><%= tag.tag_name %></option>
                                                  <% }) %>
                                                <% } else { %>
                                                  <option value="">No tags available</option>
                                                <% } %>
                                              </select>
                                            </div>
                                          </div>
                                        </div>
                                        
                                       
                                        </div>  
                                  </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">Close</button>
                                    <button class="btn btn-primary w-md waves-effect waves-light" type="submit">Submit</button>
                                  </div>
                                </form>
                              </div>
                            </div>
                              
              </div><!-- /.modal -->
              
            </div>
        </div> <!-- end row -->
    </div>
</div>

<%- contentFor('FooterJs') %>

<%- contentFor('BottomJs') %>
<script>
  const monthsOfYear = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
  const monthDays = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

  function isLeapYear(year) {
    return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
  }

  function updateDaysDropdown(year, month, dayDropdown) {
    const daysInMonth = month === 1 && isLeapYear(year) ? 29 : monthDays[month];
    dayDropdown.innerHTML = '';
    for (let i = 1; i <= daysInMonth; i++) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = i;
      dayDropdown.appendChild(option);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    const startYearDropdown = document.getElementById('start_date_year');
    const startMonthDropdown = document.getElementById('start_date_month');
    const startDayDropdown = document.getElementById('start_date_day');
    const endYearDropdown = document.getElementById('end_date_year');
    const endMonthDropdown = document.getElementById('end_date_month');
    const endDayDropdown = document.getElementById('end_date_day');
    const nextMilestoneYearDropdown = document.getElementById('next_milestone_year');
    const nextMilestoneMonthDropdown = document.getElementById('next_milestone_month');
    const nextMilestoneDayDropdown = document.getElementById('next_milestone_day');

    function updateStartDays() {
      const year = parseInt(startYearDropdown.value);
      const month = startMonthDropdown.selectedIndex;
      updateDaysDropdown(year, month, startDayDropdown);
    }

    function updateEndDays() {
      const year = parseInt(endYearDropdown.value);
      const month = endMonthDropdown.selectedIndex;
      updateDaysDropdown(year, month, endDayDropdown);
    }

    function updateNextMilestoneDays() {
      const year = parseInt(nextMilestoneYearDropdown.value);
      const month = nextMilestoneMonthDropdown.selectedIndex;
      updateDaysDropdown(year, month, nextMilestoneDayDropdown);
    }

    startYearDropdown.addEventListener('change', () => {
      const selectedYear = startYearDropdown.value;
      console.log(`Selected start year: ${selectedYear}`);
      localStorage.setItem('selectedStartYear', selectedYear);
      updateStartDays();
    });

    startMonthDropdown.addEventListener('change', updateStartDays);
    endMonthDropdown.addEventListener('change', updateEndDays);

    // Initialize days dropdowns
    updateStartDays();
    updateEndDays();
    updateNextMilestoneDays();

    // Retrieve and set the selected start year from local storage
    const storedStartYear = localStorage.getItem('selectedStartYear');
    if (storedStartYear) {
      startYearDropdown.value = storedStartYear;
      updateStartDays();
    }
  });
  document.addEventListener("DOMContentLoaded", function() {
        // Get all table rows
        var rows = document.querySelectorAll(".table tbody tr");

        // Loop through each row
        rows.forEach(function(row) {
            console.log("row:",row)
            // Add a click event listener to each row
            row.addEventListener("click", function() {
                var id = row.cells[0].textContent; // Assuming the ID is in the first cell
        
                // Now you have the ID, you can use it as needed
                
                // Show the modal when a row is clicked
                window.location.replace('/projects/edit/'+id)

                // $('#personForm').modal('show'); // Assuming you're using jQuery
            });
        });
    });

</script>